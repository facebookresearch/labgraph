{"ast":null,"code":"var _ = require(\"../lodash\");\n\nvar util = require(\"../util\");\n\nmodule.exports = sort;\n\nfunction sort(entries, biasRight) {\n  var parts = util.partition(entries, function (entry) {\n    return _.has(entry, \"barycenter\");\n  });\n\n  var sortable = parts.lhs,\n      unsortable = _.sortBy(parts.rhs, function (entry) {\n    return -entry.i;\n  }),\n      vs = [],\n      sum = 0,\n      weight = 0,\n      vsIndex = 0;\n\n  sortable.sort(compareWithBias(!!biasRight));\n  vsIndex = consumeUnsortable(vs, unsortable, vsIndex);\n\n  _.forEach(sortable, function (entry) {\n    vsIndex += entry.vs.length;\n    vs.push(entry.vs);\n    sum += entry.barycenter * entry.weight;\n    weight += entry.weight;\n    vsIndex = consumeUnsortable(vs, unsortable, vsIndex);\n  });\n\n  var result = {\n    vs: _.flatten(vs, true)\n  };\n\n  if (weight) {\n    result.barycenter = sum / weight;\n    result.weight = weight;\n  }\n\n  return result;\n}\n\nfunction consumeUnsortable(vs, unsortable, index) {\n  var last;\n\n  while (unsortable.length && (last = _.last(unsortable)).i <= index) {\n    unsortable.pop();\n    vs.push(last.vs);\n    index++;\n  }\n\n  return index;\n}\n\nfunction compareWithBias(bias) {\n  return function (entryV, entryW) {\n    if (entryV.barycenter < entryW.barycenter) {\n      return -1;\n    } else if (entryV.barycenter > entryW.barycenter) {\n      return 1;\n    }\n\n    return !bias ? entryV.i - entryW.i : entryW.i - entryV.i;\n  };\n}","map":{"version":3,"sources":["C:/Users/zenak/Desktop/labgraph_monitor/node_modules/dagre/lib/order/sort.js"],"names":["_","require","util","module","exports","sort","entries","biasRight","parts","partition","entry","has","sortable","lhs","unsortable","sortBy","rhs","i","vs","sum","weight","vsIndex","compareWithBias","consumeUnsortable","forEach","length","push","barycenter","result","flatten","index","last","pop","bias","entryV","entryW"],"mappings":"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","sourcesContent":["var _ = require(\"../lodash\");\nvar util = require(\"../util\");\n\nmodule.exports = sort;\n\nfunction sort(entries, biasRight) {\n  var parts = util.partition(entries, function(entry) {\n    return _.has(entry, \"barycenter\");\n  });\n  var sortable = parts.lhs,\n    unsortable = _.sortBy(parts.rhs, function(entry) { return -entry.i; }),\n    vs = [],\n    sum = 0,\n    weight = 0,\n    vsIndex = 0;\n\n  sortable.sort(compareWithBias(!!biasRight));\n\n  vsIndex = consumeUnsortable(vs, unsortable, vsIndex);\n\n  _.forEach(sortable, function (entry) {\n    vsIndex += entry.vs.length;\n    vs.push(entry.vs);\n    sum += entry.barycenter * entry.weight;\n    weight += entry.weight;\n    vsIndex = consumeUnsortable(vs, unsortable, vsIndex);\n  });\n\n  var result = { vs: _.flatten(vs, true) };\n  if (weight) {\n    result.barycenter = sum / weight;\n    result.weight = weight;\n  }\n  return result;\n}\n\nfunction consumeUnsortable(vs, unsortable, index) {\n  var last;\n  while (unsortable.length && (last = _.last(unsortable)).i <= index) {\n    unsortable.pop();\n    vs.push(last.vs);\n    index++;\n  }\n  return index;\n}\n\nfunction compareWithBias(bias) {\n  return function(entryV, entryW) {\n    if (entryV.barycenter < entryW.barycenter) {\n      return -1;\n    } else if (entryV.barycenter > entryW.barycenter) {\n      return 1;\n    }\n\n    return !bias ? entryV.i - entryW.i : entryW.i - entryV.i;\n  };\n}\n"]},"metadata":{},"sourceType":"script"}